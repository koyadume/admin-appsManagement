<?xml version="1.0" encoding="UTF-8"?>
<plugin:page xmlns="html5" xmlns:plugin="plugin" xmlns:c="core">
	<plugin:head>
		<script type="text/javascript" src="js/globalPermissions.js" context="global"></script>
	</plugin:head>		
				
	<plugin:body>
		<style type="text/css">
			td > div {
			    background-color: #e6e6fc;
			    min-height: 100px;
			    min-width: 200px;
			    padding: 10px 10px 0 0;
			}
			.horList1 {
			    list-style: none outside none;
			    margin: 0;
			    padding-left: 0;
			}
			.horList1 > li {
			    background-color: #f7f7f9;
			    border-radius: 2px;
			    display: inline-block;
			    margin-bottom: 10px;
			    margin-left: 10px;
			    padding-left: 10px;
			    padding-right: 10px;
			}
			.prin-del {
			    cursor: pointer;
			    margin-left: 10px;
			}
		</style>
		
		<c:if test="${not empty msg}"> 
			<p class="msg-container">
				<span class="fa fa-info-circle fa-lg" style="margin-left: 5px; margin-right: 5px; color: white;"></span>
				<c:out value="${msg.details}"/>
			</p>
		</c:if>
		
	    <div style="padding: 15px;">
	        <form name="pluginDetails" method="POST" action="savePlugin">
	        	<fieldset>
					<legend>Plugin information</legend>
	                <ul style="list-style: none;">
	                     <li>Name</li>
	                     <li>
	                     		<text property="name" size="100" disabled="disabled" />
	                     </li>
	                     <li>Title</li>
	                     <li>
	                     		<text property="title" size="100" disabled="disabled" />
	                     </li>
	                     <hidden property="id" />
	                     <!-- These are required in order to submit values of disabled input fields -->
	                     <hidden property="name" />
	                     <hidden property="version" />
	                     <hidden property="title" />
	                     <hidden property="enabled" />
	                     <hidden property="appId" />
	                </ul>
	        	</fieldset>
	        	
	        	<fieldset style="margin-top: 20px; padding: 20px;">
					<legend>Permissions</legend>
					<table style="width: 100%;" class="piston-table">
						<tr>
							<th>
								Role
							</th>
							<th>
								Permissions
							</th>
							<th>
								Actions
							</th>
						</tr>
						<tr>
							<td style="text-align:center;">
								<c:out value="MANAGER" />
							</td>
							<td style="padding: 0px;">
								<div id="manager" class="pseudo-permission-container">
									<ul class="horList1">
										<c:iterate items="${pluginDetails.manager}" var="mgr">
											<li>
												<span><c:out value="${mgr.split(':')[1]}" /></span>
												<span class="prin-del">x</span>
											</li>
										</c:iterate>
									</ul>
									<c:iterate items="${pluginDetails.manager}" var="mgr">
										<input class="pseudo-role" type="hidden" name="manager" value="${mgr}" />
									</c:iterate>
								</div>
							</td>
							<td style="text-align: center;">
								<pButton class="pt-btn pseudo-add-permission" faClass="fa fa-plus fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;"> 
				  					<c:out value="Add" />
					  			</pButton>
							</td>
						</tr>
						<tr>
							<td style="text-align:center;">
								<c:out value="EDITOR" />
							</td>
							<td style="padding: 0px;">
								<div id="editor" class="pseudo-permission-container">
									<ul class="horList1">
										<c:iterate items="${pluginDetails.editor}" var="edit">
											<li>
												<span><c:out value="${edit.split(':')[1]}" /></span>
												<span class="prin-del">x</span>
											</li>
										</c:iterate>
									</ul>
									<c:iterate items="${pluginDetails.editor}" var="edit">
										<input class="pseudo-role" type="hidden" name="editor" value="${edit}" />
									</c:iterate>
								</div>
							</td>
							<td style="text-align: center;">
								<pButton class="pt-btn pseudo-add-permission" faClass="fa fa-plus fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;"> 
			  						<c:out value="Add" />
					  			</pButton>
							</td>
						</tr>
						<tr>
							<td style="text-align:center;">
								<c:out value="USER" />
							</td>
							<td style="padding: 0px;">
								<div id="user" class="pseudo-permission-container">
									<ul class="horList1">
										<c:iterate items="${pluginDetails.user}" var="usr">
											<li>
												<span><c:out value="${usr.split(':')[1]}" /></span>
												<span class="prin-del">x</span>
											</li>
										</c:iterate>
									</ul>
									<c:iterate items="${pluginDetails.user}" var="usr">
										<input class="pseudo-role" type="hidden" name="user" value="${usr}" />
									</c:iterate>
								</div>
							</td>
							<td style="text-align: center;">
								<pButton class="pt-btn pseudo-add-permission" faClass="fa fa-plus fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;"> 
			  						<c:out value="Add" />
					  			</pButton>
							</td>
						</tr>
					</table>   
				</fieldset>
				
				<div style="text-align: right; margin-top: 20px;">
					<pButton class="pt-btn pseudo-submit-button" faClass="fa fa-save fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;"> 
		  					<c:out value="Update" />
		  			</pButton>
					<plugin:actionURL action="listPlugins" class="pt-btn" faClass="fa fa-close fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;">
						<c:out value="Close" />
						<plugin:param name="appId" value="${pluginDetails.appId}" />
					</plugin:actionURL>
				</div>
            </form>
            
            <div id="searchScreen" style="border: 1px solid #ADD8E6; display:none;">
		    	<div id="waitSearchScreen">
		    		<img src="img/ajax-loader.gif" style="margin: 15px auto;"  context="Global" />
		    	</div>
		    	<div id="searchScreenBody"></div>
		    </div>
		
	    </div>
	    
	    <script type="text/javascript">
        	<![CDATA[
        		$(function() {
				     $('.pseudo-close').click(function() {
				     	 var form = createPluginForm($(this), 'listPlugins');
				     	 var appId = getInputFieldValue(${this}.closest('form'), 'appId');
				     	 createHidden('appId', appId).appendTo(form);
				     	 form.appendTo('.pseudo-tile-content');
				     	 form.submit();
				     });
				});
			]]>
        </script>
	</plugin:body>
</plugin:page>
